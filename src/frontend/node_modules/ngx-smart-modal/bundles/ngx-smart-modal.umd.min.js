!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],factory):factory((global.ng=global.ng||{},global.ng.ngxSmartModal={}),global.ng.core,global.ng.common)}(this,function(exports,core,common){"use strict";/**
 * @license ngx-smart-modal
 * MIT license
 */
var NgxSmartModalConfig={bodyClassOpen:"dialog-open",prefixEvent:"ngx-smart-modal."},NgxSmartModalComponent=function(){function NgxSmartModalComponent(_renderer,_changeDetectorRef,componentFactoryResolver,_document,_platformId){this._renderer=_renderer,this._changeDetectorRef=_changeDetectorRef,this.componentFactoryResolver=componentFactoryResolver,this._document=_document,this._platformId=_platformId,this.closable=!0,this.escapable=!0,this.dismissable=!0,this.identifier="",this.customClass="nsm-dialog-animation-fade",this.visible=!1,this.backdrop=!0,this.force=!0,this.hideDelay=500,this.autostart=!1,this.target="",this.ariaLabel=null,this.ariaLabelledBy=null,this.ariaDescribedBy=null,this.refocus=!0,this.visibleChange=new core.EventEmitter,this.onClose=new core.EventEmitter,this.onCloseFinished=new core.EventEmitter,this.onDismiss=new core.EventEmitter,this.onDismissFinished=new core.EventEmitter,this.onAnyCloseEvent=new core.EventEmitter,this.onAnyCloseEventFinished=new core.EventEmitter,this.onOpen=new core.EventEmitter,this.onOpenFinished=new core.EventEmitter,this.onEscape=new core.EventEmitter,this.onDataAdded=new core.EventEmitter,this.onDataRemoved=new core.EventEmitter,this.layerPosition=1041,this.overlayVisible=!1,this.openedClass=!1,this.createFrom="html"}return NgxSmartModalComponent.prototype.ngOnInit=function(){if(!this.identifier||!this.identifier.length)throw new Error("identifier field isn’t set. Please set one before calling <ngx-smart-modal> in a template.");this._sendEvent("create")},NgxSmartModalComponent.prototype.ngAfterViewInit=function(){var _this=this;if(this.contentComponent){var factory_1=this.componentFactoryResolver.resolveComponentFactory(this.contentComponent);this.createDynamicContent(this.dynamicContentContainer,factory_1),this.dynamicContentContainer.changes.subscribe(function(contentViewContainers){_this.createDynamicContent(contentViewContainers,factory_1)})}},NgxSmartModalComponent.prototype.ngOnDestroy=function(){this._sendEvent("delete")},NgxSmartModalComponent.prototype.open=function(top){return this._sendEvent("open",{top:top}),this},NgxSmartModalComponent.prototype.close=function(){return this._sendEvent("close"),this},NgxSmartModalComponent.prototype.dismiss=function(e){return this.dismissable&&e.target.classList.contains("overlay")?(this._sendEvent("dismiss"),this):this},NgxSmartModalComponent.prototype.toggle=function(top){return this._sendEvent("toggle",{top:top}),this},NgxSmartModalComponent.prototype.addCustomClass=function(className){return this.customClass.length?this.customClass+=" "+className:this.customClass=className,this},NgxSmartModalComponent.prototype.removeCustomClass=function(className){return this.customClass=className?this.customClass.replace(className,"").trim():"",this},NgxSmartModalComponent.prototype.isVisible=function(){return this.visible},NgxSmartModalComponent.prototype.hasData=function(){return void 0!==this._data},NgxSmartModalComponent.prototype.setData=function(data,force){return(!this.hasData()||this.hasData()&&force)&&(this._data=data,this.onDataAdded.emit(this._data),this.markForCheck()),this},NgxSmartModalComponent.prototype.getData=function(){return this._data},NgxSmartModalComponent.prototype.removeData=function(){return this._data=void 0,this.onDataRemoved.emit(!0),this.markForCheck(),this},NgxSmartModalComponent.prototype.addBodyClass=function(){return this._renderer.addClass(this._document.body,NgxSmartModalConfig.bodyClassOpen),this},NgxSmartModalComponent.prototype.removeBodyClass=function(){return this._renderer.removeClass(this._document.body,NgxSmartModalConfig.bodyClassOpen),this},NgxSmartModalComponent.prototype.markForCheck=function(){try{this._changeDetectorRef.detectChanges()}catch(e){}this._changeDetectorRef.markForCheck()},NgxSmartModalComponent.prototype.targetPlacement=function(){if(!(this.isBrowser&&this.nsmDialog.length&&this.nsmContent.length&&this.nsmOverlay.length&&this.target))return!1;var targetElement=this._document.querySelector(this.target);if(!targetElement)return!1;var targetElementRect=targetElement.getBoundingClientRect(),bodyRect=this.nsmOverlay.first.nativeElement.getBoundingClientRect(),nsmContentRect=this.nsmContent.first.nativeElement.getBoundingClientRect(),nsmDialogRect=this.nsmDialog.first.nativeElement.getBoundingClientRect(),marginLeft=parseInt(getComputedStyle(this.nsmContent.first.nativeElement).marginLeft,10),marginTop=parseInt(getComputedStyle(this.nsmContent.first.nativeElement).marginTop,10),offsetTop=targetElementRect.top-nsmDialogRect.top-(nsmContentRect.height-targetElementRect.height)/2,offsetLeft=targetElementRect.left-nsmDialogRect.left-(nsmContentRect.width-targetElementRect.width)/2;offsetLeft+nsmDialogRect.left+nsmContentRect.width+2*marginLeft>bodyRect.width?offsetLeft=bodyRect.width-(nsmDialogRect.left+nsmContentRect.width)-2*marginLeft:offsetLeft+nsmDialogRect.left<0&&(offsetLeft=-nsmDialogRect.left),offsetTop+nsmDialogRect.top+nsmContentRect.height+marginTop>bodyRect.height&&(offsetTop=bodyRect.height-(nsmDialogRect.top+nsmContentRect.height)-marginTop),this._renderer.setStyle(this.nsmContent.first.nativeElement,"top",(offsetTop<0?0:offsetTop)+"px"),this._renderer.setStyle(this.nsmContent.first.nativeElement,"left",offsetLeft+"px")},NgxSmartModalComponent.prototype._sendEvent=function(name,extraData){if(!this.isBrowser)return!1;var data={extraData:extraData,instance:{id:this.identifier,modal:this}},event=new CustomEvent(NgxSmartModalConfig.prefixEvent+name,{detail:data});return window.dispatchEvent(event)},Object.defineProperty(NgxSmartModalComponent.prototype,"isBrowser",{get:function(){return common.isPlatformBrowser(this._platformId)},enumerable:!0,configurable:!0}),NgxSmartModalComponent.prototype.createDynamicContent=function(changes,factory){var _this=this;changes.forEach(function(viewContainerRef){viewContainerRef.clear(),viewContainerRef.createComponent(factory),_this.markForCheck()})},NgxSmartModalComponent.decorators=[{type:core.Component,args:[{selector:"ngx-smart-modal",template:'\n    <div *ngIf="overlayVisible"\n         [style.z-index]="visible ? layerPosition-1 : -1"\n         [ngClass]="{\'transparent\':!backdrop, \'overlay\':true, \'nsm-overlay-open\':openedClass}"\n         (mousedown)="dismiss($event)" #nsmOverlay>\n      <div [style.z-index]="visible ? layerPosition : -1"\n           [ngClass]="[\'nsm-dialog\', customClass, openedClass ? \'nsm-dialog-open\': \'nsm-dialog-close\']" #nsmDialog\n           [attr.aria-hidden]="openedClass ? false : true"\n           [attr.aria-label]="ariaLabel"\n           [attr.aria-labelledby]="ariaLabelledBy"\n           [attr.aria-describedby]="ariaDescribedBy">\n        <div class="nsm-content" #nsmContent>\n          <div class="nsm-body">\n            <ng-template #dynamicContent></ng-template>\n            <ng-content></ng-content>\n\n          </div>\n          <button type="button" *ngIf="closable" (click)="close()" aria-label="Close" class="nsm-dialog-btn-close">\n            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512"\n                 xml:space="preserve" width="16px" height="16px">\n              <g>\n                <path d="M505.943,6.058c-8.077-8.077-21.172-8.077-29.249,0L6.058,476.693c-8.077,8.077-8.077,21.172,0,29.249    C10.096,509.982,15.39,512,20.683,512c5.293,0,10.586-2.019,14.625-6.059L505.943,35.306    C514.019,27.23,514.019,14.135,505.943,6.058z"\n                      fill="currentColor"/>\n              </g>\n              <g>\n                <path d="M505.942,476.694L35.306,6.059c-8.076-8.077-21.172-8.077-29.248,0c-8.077,8.076-8.077,21.171,0,29.248l470.636,470.636    c4.038,4.039,9.332,6.058,14.625,6.058c5.293,0,10.587-2.019,14.624-6.057C514.018,497.866,514.018,484.771,505.942,476.694z"\n                      fill="currentColor"/>\n              </g>\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>\n  '}]}],NgxSmartModalComponent.ctorParameters=function(){return[{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:core.ComponentFactoryResolver},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:void 0,decorators:[{type:core.Inject,args:[core.PLATFORM_ID]}]}]},NgxSmartModalComponent.propDecorators={closable:[{type:core.Input}],escapable:[{type:core.Input}],dismissable:[{type:core.Input}],identifier:[{type:core.Input}],customClass:[{type:core.Input}],visible:[{type:core.Input}],backdrop:[{type:core.Input}],force:[{type:core.Input}],hideDelay:[{type:core.Input}],autostart:[{type:core.Input}],target:[{type:core.Input}],ariaLabel:[{type:core.Input}],ariaLabelledBy:[{type:core.Input}],ariaDescribedBy:[{type:core.Input}],refocus:[{type:core.Input}],visibleChange:[{type:core.Output}],onClose:[{type:core.Output}],onCloseFinished:[{type:core.Output}],onDismiss:[{type:core.Output}],onDismissFinished:[{type:core.Output}],onAnyCloseEvent:[{type:core.Output}],onAnyCloseEventFinished:[{type:core.Output}],onOpen:[{type:core.Output}],onOpenFinished:[{type:core.Output}],onEscape:[{type:core.Output}],onDataAdded:[{type:core.Output}],onDataRemoved:[{type:core.Output}],nsmContent:[{type:core.ViewChildren,args:["nsmContent"]}],nsmDialog:[{type:core.ViewChildren,args:["nsmDialog"]}],nsmOverlay:[{type:core.ViewChildren,args:["nsmOverlay"]}],dynamicContentContainer:[{type:core.ViewChildren,args:["dynamicContent",{read:core.ViewContainerRef}]}],targetPlacement:[{type:core.HostListener,args:["window:resize"]}]},NgxSmartModalComponent}(),NgxSmartModalStackService=function(){function NgxSmartModalStackService(){this._modalStack=[]}return NgxSmartModalStackService.prototype.addModal=function(modalInstance,force){if(force){var i=this._modalStack.findIndex(function(o){return o.id===modalInstance.id});i>-1?this._modalStack[i].modal=modalInstance.modal:this._modalStack.push(modalInstance)}else this._modalStack.push(modalInstance)},NgxSmartModalStackService.prototype.getModal=function(id){var i=this._modalStack.find(function(o){return o.id===id});if(void 0!==i)return i.modal;throw new Error("Cannot find modal with identifier "+id)},NgxSmartModalStackService.prototype.getModalStack=function(){return this._modalStack},NgxSmartModalStackService.prototype.getOpenedModals=function(){return this._modalStack.filter(function(o){return o.modal.visible})},NgxSmartModalStackService.prototype.getTopOpenedModal=function(){if(!this.getOpenedModals().length)throw new Error("No modal is opened");return this.getOpenedModals().map(function(o){return o.modal}).reduce(function(highest,item){return item.layerPosition>highest.layerPosition?item:highest},this.getOpenedModals()[0].modal)},NgxSmartModalStackService.prototype.getHigherIndex=function(){return Math.max.apply(Math,this._modalStack.map(function(o){return o.modal.layerPosition}).concat([1041]))+1},NgxSmartModalStackService.prototype.getModalStackCount=function(){return this._modalStack.length},NgxSmartModalStackService.prototype.removeModal=function(id){var i=this._modalStack.findIndex(function(o){return o.id===id});i>-1&&this._modalStack.splice(i,1)},NgxSmartModalStackService.decorators=[{type:core.Injectable}],NgxSmartModalStackService.ctorParameters=function(){return[]},NgxSmartModalStackService}(),NgxSmartModalService=function(){function NgxSmartModalService(_componentFactoryResolver,_appRef,_injector,_modalStack,applicationRef,_document,_platformId){var _this=this;this._componentFactoryResolver=_componentFactoryResolver,this._appRef=_appRef,this._injector=_injector,this._modalStack=_modalStack,this.applicationRef=applicationRef,this._document=_document,this._platformId=_platformId,this._escapeKeyboardEvent=function(event){if("Escape"===event.key)try{var modal=_this.getTopOpenedModal();return!!modal.escapable&&(modal.onEscape.emit(modal),_this.closeLatestModal(),!0)}catch(e){return!1}return!1},this._trapFocusModal=function(event){if("Tab"===event.key)try{var modal=_this.getTopOpenedModal();return modal.nsmDialog.first.nativeElement.contains(document.activeElement)||(event.preventDefault(),event.stopPropagation(),modal.nsmDialog.first.nativeElement.focus()),!0}catch(e){return!1}return!1},this._addEvents()}return NgxSmartModalService.prototype.addModal=function(modalInstance,force){this._modalStack.addModal(modalInstance,force)},NgxSmartModalService.prototype.getModal=function(id){return this._modalStack.getModal(id)},NgxSmartModalService.prototype.get=function(id){return this.getModal(id)},NgxSmartModalService.prototype.open=function(id,force){return void 0===force&&(force=!1),this._openModal(this.get(id),force)},NgxSmartModalService.prototype.close=function(id){return this._closeModal(this.get(id))},NgxSmartModalService.prototype.closeAll=function(){var _this=this;this.getOpenedModals().forEach(function(instance){_this._closeModal(instance.modal)})},NgxSmartModalService.prototype.toggle=function(id,force){return void 0===force&&(force=!1),this._toggleModal(this.get(id),force)},NgxSmartModalService.prototype.getModalStack=function(){return this._modalStack.getModalStack()},NgxSmartModalService.prototype.getOpenedModals=function(){return this._modalStack.getOpenedModals()},NgxSmartModalService.prototype.getTopOpenedModal=function(){return this._modalStack.getTopOpenedModal()},NgxSmartModalService.prototype.getHigherIndex=function(){return this._modalStack.getHigherIndex()},NgxSmartModalService.prototype.getModalStackCount=function(){return this._modalStack.getModalStackCount()},NgxSmartModalService.prototype.removeModal=function(id){this._modalStack.removeModal(id)},NgxSmartModalService.prototype.setModalData=function(data,id,force){var i;return!!(i=this.get(id))&&(i.setData(data,force),!0)},NgxSmartModalService.prototype.getModalData=function(id){var i;return(i=this.get(id))?i.getData():null},NgxSmartModalService.prototype.resetModalData=function(id){if(this._modalStack.getModalStack().find(function(o){return o.id===id})){var removed=this.getModal(id).getData();return this.getModal(id).removeData(),removed}return!1},NgxSmartModalService.prototype.closeLatestModal=function(){this.getTopOpenedModal().close()},NgxSmartModalService.prototype.create=function(id,content,options){void 0===options&&(options={});try{return this.getModal(id)}catch(e){var componentFactory=this._componentFactoryResolver.resolveComponentFactory(NgxSmartModalComponent),ngContent=this._resolveNgContent(content),componentRef=componentFactory.create(this._injector,ngContent);content instanceof core.Type&&(componentRef.instance.contentComponent=content),componentRef.instance.identifier=id,componentRef.instance.createFrom="service","boolean"==typeof options.closable&&(componentRef.instance.closable=options.closable),"boolean"==typeof options.escapable&&(componentRef.instance.escapable=options.escapable),"boolean"==typeof options.dismissable&&(componentRef.instance.dismissable=options.dismissable),"string"==typeof options.customClass&&(componentRef.instance.customClass=options.customClass),"boolean"==typeof options.backdrop&&(componentRef.instance.backdrop=options.backdrop),"boolean"==typeof options.force&&(componentRef.instance.force=options.force),"number"==typeof options.hideDelay&&(componentRef.instance.hideDelay=options.hideDelay),"boolean"==typeof options.autostart&&(componentRef.instance.autostart=options.autostart),"string"==typeof options.target&&(componentRef.instance.target=options.target),"string"==typeof options.ariaLabel&&(componentRef.instance.ariaLabel=options.ariaLabel),"string"==typeof options.ariaLabelledBy&&(componentRef.instance.ariaLabelledBy=options.ariaLabelledBy),"string"==typeof options.ariaDescribedBy&&(componentRef.instance.ariaDescribedBy=options.ariaDescribedBy),"boolean"==typeof options.refocus&&(componentRef.instance.refocus=options.refocus),this._appRef.attachView(componentRef.hostView);var domElem=componentRef.hostView.rootNodes[0];return this._document.body.appendChild(domElem),componentRef.instance}},NgxSmartModalService.prototype._addEvents=function(){var _this=this;return!!this.isBrowser&&(window.addEventListener(NgxSmartModalConfig.prefixEvent+"create",function(e){_this._initModal(e.detail.instance)}),window.addEventListener(NgxSmartModalConfig.prefixEvent+"delete",function(e){_this._deleteModal(e.detail.instance)}),window.addEventListener(NgxSmartModalConfig.prefixEvent+"open",function(e){_this._openModal(e.detail.instance.modal,e.detail.top)}),window.addEventListener(NgxSmartModalConfig.prefixEvent+"toggle",function(e){_this._toggleModal(e.detail.instance.modal,e.detail.top)}),window.addEventListener(NgxSmartModalConfig.prefixEvent+"close",function(e){_this._closeModal(e.detail.instance.modal)}),window.addEventListener(NgxSmartModalConfig.prefixEvent+"dismiss",function(e){_this._dismissModal(e.detail.instance.modal)}),window.addEventListener("keyup",this._escapeKeyboardEvent),!0)},NgxSmartModalService.prototype._initModal=function(modalInstance){modalInstance.modal.layerPosition+=this.getModalStackCount(),this.addModal(modalInstance,modalInstance.modal.force),modalInstance.modal.autostart&&this.open(modalInstance.id)},NgxSmartModalService.prototype._openModal=function(modal,top){return!modal.visible&&(this.lastElementFocused=document.activeElement,modal.escapable&&window.addEventListener("keyup",this._escapeKeyboardEvent),modal.backdrop&&window.addEventListener("keydown",this._trapFocusModal),top&&(modal.layerPosition=this.getHigherIndex()),modal.addBodyClass(),modal.overlayVisible=!0,modal.visible=!0,modal.onOpen.emit(modal),modal.markForCheck(),setTimeout(function(){modal.openedClass=!0,modal.target&&modal.targetPlacement(),modal.nsmDialog.first.nativeElement.setAttribute("role","dialog"),modal.nsmDialog.first.nativeElement.setAttribute("tabIndex","-1"),modal.nsmDialog.first.nativeElement.setAttribute("aria-modal","true"),modal.nsmDialog.first.nativeElement.focus(),modal.markForCheck(),modal.onOpenFinished.emit(modal)}),!0)},NgxSmartModalService.prototype._toggleModal=function(modal,top){return modal.visible?this._closeModal(modal):this._openModal(modal,top)},NgxSmartModalService.prototype._closeModal=function(modal){var _this=this;return!!modal.openedClass&&(modal.openedClass=!1,modal.onClose.emit(modal),modal.onAnyCloseEvent.emit(modal),this.getOpenedModals().length<2&&(modal.removeBodyClass(),window.removeEventListener("keyup",this._escapeKeyboardEvent),window.removeEventListener("keydown",this._trapFocusModal)),setTimeout(function(){modal.visibleChange.emit(modal.visible),modal.visible=!1,modal.overlayVisible=!1,modal.nsmDialog.first.nativeElement.removeAttribute("tabIndex"),modal.markForCheck(),modal.onCloseFinished.emit(modal),modal.onAnyCloseEventFinished.emit(modal),modal.refocus&&_this.lastElementFocused.focus()},modal.hideDelay),!0)},NgxSmartModalService.prototype._dismissModal=function(modal){return!!modal.openedClass&&(modal.openedClass=!1,modal.onDismiss.emit(modal),modal.onAnyCloseEvent.emit(modal),this.getOpenedModals().length<2&&modal.removeBodyClass(),setTimeout(function(){modal.visible=!1,modal.visibleChange.emit(modal.visible),modal.overlayVisible=!1,modal.markForCheck(),modal.onDismissFinished.emit(modal),modal.onAnyCloseEventFinished.emit(modal)},modal.hideDelay),!0)},NgxSmartModalService.prototype._deleteModal=function(modalInstance){this.removeModal(modalInstance.id),this.getModalStack().length||modalInstance.modal.removeBodyClass()},NgxSmartModalService.prototype._resolveNgContent=function(content){if("string"==typeof content)return[[this._document.createTextNode(content)]];if(content instanceof core.TemplateRef){var viewRef=content.createEmbeddedView(null);return this.applicationRef.attachView(viewRef),[viewRef.rootNodes]}return[]},Object.defineProperty(NgxSmartModalService.prototype,"isBrowser",{get:function(){return common.isPlatformBrowser(this._platformId)},enumerable:!0,configurable:!0}),NgxSmartModalService.decorators=[{type:core.Injectable}],NgxSmartModalService.ctorParameters=function(){return[{type:core.ComponentFactoryResolver},{type:core.ApplicationRef},{type:core.Injector},{type:NgxSmartModalStackService},{type:core.ApplicationRef},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:void 0,decorators:[{type:core.Inject,args:[core.PLATFORM_ID]}]}]},NgxSmartModalService}(),NgxSmartModalModule=function(){function NgxSmartModalModule(serivce){this.serivce=serivce}return NgxSmartModalModule.forRoot=function(){return{ngModule:NgxSmartModalModule,providers:[NgxSmartModalService,NgxSmartModalStackService]}},NgxSmartModalModule.forChild=function(){return{ngModule:NgxSmartModalModule,providers:[NgxSmartModalService,NgxSmartModalStackService]}},NgxSmartModalModule.decorators=[{type:core.NgModule,args:[{declarations:[NgxSmartModalComponent],entryComponents:[NgxSmartModalComponent],exports:[NgxSmartModalComponent],imports:[common.CommonModule]}]}],NgxSmartModalModule.ctorParameters=function(){return[{type:NgxSmartModalService}]},NgxSmartModalModule}();exports.NgxSmartModalService=NgxSmartModalService,exports.NgxSmartModalComponent=NgxSmartModalComponent,exports.NgxSmartModalModule=NgxSmartModalModule,exports.NgxSmartModalConfig=NgxSmartModalConfig,exports.ɵa=NgxSmartModalStackService,Object.defineProperty(exports,"__esModule",{value:!0})});