<ngx-smart-modal
  #optionsModal
  (onAnyCloseEvent)="onAnyCloseEvent()"
  (onDataAdded)="onDataAdded()"
  (onOpen)="onOpen()"
  class="optionsModal"
  customClass="nsm-centered"
  identifier="optionsModal"
>
  <div>
    <h2>
      {{ structureNode?.type
      }}<ng-container *ngIf="element?.name !== structureNode?.type"
        >({{ element?.name }}) </ng-container
      >: {{ structureNode?.name }}
    </h2>
    <p [innerHTML]="element?.description" class="description"></p>
    <a
      href="{{ frankDocElementsURI }}/{{ element?.name }}"
      style="text-decoration: none"
      target="_blank"
    >
      <app-button [block]="true"
        >Read more about {{ element?.name }}</app-button
      >
    </a>
    <hr />
    <!-- TODO: Name and type here, those are generic for all nodes. Other attributes can be seen as 'additional' -->
    <h2>Attributes</h2>
    <div *ngIf="availableAttributes.length > 0" class="input-row">
      <label for="selectAttribute">Add attribute:</label>
      <select [(ngModel)]="selectedAttribute" id="selectAttribute" required>
        <option [ngValue]="undefined" disabled hidden selected>
          Choose an attribute...
        </option>
        <option
          *ngFor="let availableAttribute of availableAttributes"
          [hidden]="
            attributeIsUsed(availableAttribute?.name) ||
            availableAttribute?.deprecated
          "
          [ngValue]="availableAttribute"
        >
          {{ availableAttribute?.name }}
        </option>
      </select>
    </div>
    <div *ngIf="selectedAttribute" class="input-row">
      <label for="newAttribute">New attribute value:</label>
      <input
        (keyup.enter)="addAttribute()"
        [(ngModel)]="newAttributeValue"
        [placeholder]="selectedAttribute?.default ?? ''"
        id="newAttribute"
        type="text"
      />
    </div>
    <div
      *ngIf="selectedAttribute && selectedAttribute?.description"
      class="row"
    >
      <label>Description of attribute</label>
      <p [innerHTML]="selectedAttribute?.description"></p>
    </div>
    <div *ngIf="newAttributeValue" class="row">
      <app-button (click)="addAttribute()" [block]="true"
        >Add {{ selectedAttribute?.name }}</app-button
      >
    </div>
    <hr />
    <ng-container
      *ngFor="
        let attribute of attributes | keyvalue;
        trackBy: customTrackBy;
        index as i
      "
    >
      <div
        *ngIf="!disabledAttributes.includes(attribute.key)"
        class="input-row"
      >
        <label>{{ attribute.key }}:</label>
        <div
          class="input-row--input-with-button"
          *ngIf="
            !nonRemovableAttributes.includes(attribute.key);
            else inputOnly
          "
        >
          <input
            (keyup.enter)="optionsModal.close()"
            (ngModelChange)="changeAttribute(attribute.key, $event)"
            [ngModel]="attributes[attribute.key].value"
            type="text"
          />
          <app-button
            (click)="deleteAttribute(attribute.key)"
            title="Delete attribute"
          >
            <fa-icon [icon]="['fas', 'trash']"></fa-icon>
          </app-button>
        </div>
        <ng-template #inputOnly>
          <input
            (keyup.enter)="optionsModal.close()"
            (ngModelChange)="changeAttribute(attribute.key, $event)"
            [ngModel]="attributes[attribute.key].value"
            type="text"
          />
        </ng-template>
      </div>
    </ng-container>
    <hr />
    <div class="input-row">
      <label>Permanently delete this {{ structureNode?.type }}</label>
      <app-button (click)="deleteNode()" [block]="true"
        >Delete {{ structureNode?.name }}</app-button
      >
    </div>
  </div>
</ngx-smart-modal>
